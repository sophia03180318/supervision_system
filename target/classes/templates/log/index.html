<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" th:href="@{../layui/css/layui.css}">
</head>
<body>


<form class="layui-form" action="">
    <div class="layui-form-item ">
        <div class="layui-inline">
            <label class="layui-form-label">卡斯柯设备id</label>
            <div class="layui-input-inline">
                <input id="detectionMsgDeviceId" type="text" name="title" required lay-verify="required"
                       placeholder="卡斯柯设备id" autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-inline">
            <label class="layui-form-label">消息类型</label>
            <div class="layui-input-inline">
                <select id="msgType" lay-verify="required">
                    <option value=""></option>
                    <option value="191">注册消息</option>
                    <option value="185">探测消息</option>
                    <option value="187">单属性状态消息</option>
                    <option value="188">一组属性状态消息</option>
                    <option value="192">容量属性状态消息</option>
                </select>
            </div>
        </div>

        <div class="layui-inline">
            <label class="layui-form-label">属性类型</label>
            <div class="layui-input-inline">
                <select id="attrType" lay-verify="required">
                    <option value=""></option>
                    <option value="1">主备属性</option>
                    <option value="2">连接属性</option>
                    <option value="3">容量属性</option>
                    <option value="7">自定义属性</option>
                </select>
            </div>
        </div>

        <div class="layui-inline">
            <label class="layui-form-label">ip地址</label>
            <div class="layui-input-inline">
                <input id="ip" type="text" name="title" required lay-verify="required" placeholder="卡斯柯设备ip"
                       autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-inline">
            <label class="layui-form-label">属性索引</label>
            <div class="layui-input-inline">
                <input id="attrIndex" type="text" name="title" required lay-verify="required" placeholder="属性索引"
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">属性组ID</label>
            <div class="layui-input-inline">
                <input id="attrGroupId" type="text" name="title" required lay-verify="required" placeholder="属性组Id"
                       autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-inline">
            <label class="layui-form-label">卡斯柯实体号</label>
            <div class="layui-input-inline">
                <input id="cascoEntityId" type="text" name="title" required lay-verify="required" placeholder="卡斯柯实体号"
                       autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-inline">
            <label class="layui-form-label">卡斯柯设备名称</label>
            <div class="layui-input-inline">
                <input id="cascoDeviceName" type="text" name="title" required lay-verify="required"
                       placeholder="卡斯柯设备名称" autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-inline">
            <label class="layui-form-label">卡斯柯设备AB机标识</label>
            <div class="layui-input-inline">
                <select id="cascoDeviceAbFlag" lay-verify="required">
                    <option value=""></option>
                    <option value="0">A机</option>
                    <option value="1">B机</option>
                </select>
            </div>
        </div>

        <div class="layui-inline">
            <label class="layui-form-label">响应消息</label>
            <div class="layui-input-inline">
                <input id="repMsg" type="text" name="title" required lay-verify="required" placeholder="响应消息"
                       autocomplete="off" class="layui-input">
            </div>
        </div>


    </div>

    <div class="layui-form-item ">
        <button id="search" type="button" class="layui-btn">搜索</button>
    </div>


    <div class="layui-form-item layui-col-md12">
        <table class="layui-hide" id="dataTable" lay-filter="dataTable"></table>

    </div>

</form>


</body>

<style>
    .layui-table-view .layui-table[lay-size=lg] .layui-table-cell {
        height: auto;
    }

    .layui-table-cell {
        height: auto;
    }

    .layui-table-cell, .layui-table-tool-panel li {
        overflow: hidden;
        text-overflow: inherit;
        white-space: inherit;
    }

    .layui-table-cell {
        padding: inherit

    }

    .layui-table-cell {
        height: 36px;
        line-height: 36px;
    }

    .layui-form-label {
        width: 100px;
    }
</style>
<script th:src="@{../layui/layui.js}"></script>
<script th:inline="none">
    layui.use(['table', 'form', 'layer'], function () {
        var $ = layui.jquery,
            table = layui.table;
        var layer = layui.layer;
        var opt = {
            page: true
            , id: "table1"
            , elem: '#dataTable'
            , type: 'checkbox'
            , url: '/log/list'
            , method: 'post'
            , contentType: "application/json;charset=utf-8"
            , cols: [[
                {title: '序号', type: 'numbers'}
                // , {type:'checkbox'}
                , {field: 'id', title: '消息id', width: 160}
                // , {field: 'detectionId', title: '探测id'}
                , {
                    field: 'msgType', title: '消息类型', templet: function (d) {
                        switch (d.msgType) {
                            case 185:
                                return '探测消息'
                            case 191:
                                return '注册消息'
                            case 187:
                                return '单属性消息'
                            case 188:
                                return '一组属性消息'
                            case 192:
                                return '容量属性消息'
                        }
                        return ''
                    }
                    , width: 100
                }
                // , {field: 'detectionMsgDeviceId', title: '卡斯柯设备ID'}
                // , {field: 'registerMsgDeviceIdList',  title: '注册消息卡斯柯设备ID列表'}
                , {
                    field: 'attrType', title: '属性类型', templet: function (d) {
                        switch (d.attrType) {
                            case 1:
                                return '主备属性'
                            case 2:
                                return '连接属性'
                            case 3:
                                return '容量属性'
                            case 7:
                                return '自定义'
                        }
                        return ''
                    }
                }

                , {field: 'entityId', title: '卡斯柯实体号', width: 100}
                , {
                    field: 'abFlag', title: 'A,B机标识', width: 50, templet: function (d) {
                        switch (d.abFlag * 1) {
                            case 0:
                                return 'A机'
                            case 1:
                                return 'B机'
                        }
                        return ''
                    }
                }
                , {field: 'ipAddr1', title: 'ip1', width: 100}
                , {field: 'name', title: '卡斯柯设备名', width: 100}
                , {field: 'attrIndex', title: '属性索引'}
                , {field: 'attrGroupId', title: '属性组号'}
                , {field: 'msgSengTime', title: '消息发送时间', width: 200}
                , {field: 'msgReceiveTime', title: '消息接收时间', width: 200}
                , {field: 'msgHandleTime', title: '消息处理完成时间', width: 200}
                , {field: 'msgRepValue', title: '消息响应值'}
                // , {field: 'sendHexMsg',title: '发送报文'}
                // , {field: 'receiveHexMsg',title: '接收报文'}
                // , {field: 'cascoServiceIp',title: 'cascoIP'}
                // , {field: 'cascoServicePort',title: 'casco端口'}
                // , {field: 'localMonitorIp',title: '本地IP'}
                // , {field: 'localMonitorPort',title: '本地端口'}
            ]]
            , parseData: function (res) { //res 即为原始返回的数据
                console.log(res.data.total)
                console.log(res.data.list)

                return {
                    "code": res.code == 200 ? 0 : -1, //解析接口状态
                    "msg": res.message, //解析提示文本
                    "count": res.data.total, //解析数据长度
                    "data": res.data.list //解析数据列表
                };
            },

			limits: [10, 50, 100, 200, 400, 800, 1600,3200,6400,10000]
        }
        table.render(opt);
        //单击变色
        table.on('row(dataTable)', function (obj) {
            //console.log(obj.tr) //得到当前行元素对象
            $('tr').removeClass("layui-bg-green")
            $(obj.tr).addClass("layui-bg-green")
        });
        //双击展示详情
        table.on('rowDouble(dataTable)', function (obj) {
        	console.log(JSON.stringify(obj.data))
            layer.alert(JSON.stringify(obj.data).replace(/\\ /g, ""));
        });


        $('#search').on('click', function () {
            var attrType = $('#attrType').val();
            var detectionMsgDeviceId = $('#detectionMsgDeviceId').val();
            var msgType = $('#msgType').val();
            var ip = $('#ip').val();
            var attrIndex = $('#attrIndex').val();
            var attrGroupId = $('#attrGroupId').val();
            var cascoEntityId = $('#cascoEntityId').val();
            var cascoDeviceName = $('#cascoDeviceName').val();
            var cascoDeviceAbFlag = $('#cascoDeviceAbFlag').val();
            var repMsg = $('#repMsg').val();

            table.reload('table1', {
                page: {
                    curr: 1 //重新从第 1 页开始
                }
                , where: {
                    attrType: attrType,
                    detectionMsgDeviceId: detectionMsgDeviceId,
                    msgType: msgType,
                    ip: ip,
                    attrIndex: attrIndex,
                    attrGroupId: attrGroupId,
                    cascoEntityId: cascoEntityId,
                    cascoDeviceName: cascoDeviceName,
                    cascoDeviceAbFlag: cascoDeviceAbFlag,
                    repMsg: repMsg,


                }
            }, 'data');
        })


    });


</script>
</html>