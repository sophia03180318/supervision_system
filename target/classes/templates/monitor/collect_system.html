<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" th:href="@{../layui/css/layui.css}">
</head>
<body>

<div>

    <div class="layui-tab layui-tab-brief" lay-filter="layui-tab_1">
        <ul class="layui-tab-title">
            <li class="layui-this">线程池监控</li>
        </ul>
        <div class="layui-tab-content">
            <div class="layui-tab-item layui-show">
                <form class="layui-form" action="">
                    <p>当前队列:</p>
                    <table class="" id="dataTable2"></table>
                </form>
            </div>

            <div class="layui-tab-item layui-show">
                <form class="layui-form" action="">
                    <p>当前线程池:</p>
                    <table class="" id="dataTable1"></table>
                </form>
            </div>


        </div>


    </div>

</div>


</body>

<style>
    .layui-table-view .layui-table[lay-size=lg] .layui-table-cell{
        height: auto;
    }
    .layui-table-cell{
        height: auto;
    }
    .layui-table-cell, .layui-table-tool-panel li {
        overflow: hidden;
        text-overflow: inherit;
        white-space: inherit;
    }

    .layui-table-cell {
         padding: inherit

    }
    .layui-table-cell{
        height:36px;
        line-height: 36px;
    }
</style>
<script th:src="@{../layui/layui.js}"></script>
<script th:inline="none">
    var laytpl ;
    var layer;
    var jq
    var form


    layui.use(['layer','form','element','table'], function(){ //独立版的layer无需执行这一句
        laytpl = layui.laytpl;
        var $ = layui.jquery, layer = layui.layer; //
        jq=layui.jquery;
        window.jq=jq;
         form = layui.form;
        table = layui.table;
         element = layui.element;
        //监听工具条
        table.on('tool(dataTable)', function(obj){
            var data = obj.data;
            if(obj.event === 'repSizeRankList'){
                layer.msg('ID：'+ data.cycleId + ' 的查看操作');
                window.open("/monitor/getRepSizeRankPage?cycleId="+data.cycleId);
            }
        });


        var opt1=  {
            id:"table1"
            ,elem: '#dataTable1'
            // ,type:'checkbox'
            , url: '/monitor/getThreadPoolMonitorNode'
            , cellMinWidth: 80
            ,contentType:'application/json'
            , method: 'post'
            , cols: [[
                {title: '序号', type: 'numbers'}
                // , {type:'checkbox'}
                , {field: 'poolName',  title: '线程池名称',width:200}
                , {field: 'poolSize',  title: '当前线程数'}
                , {field: 'corePoolSize', title: '核心线程数'}
                , {field: 'activeCount', title: '正在执行的任务数量'}
                , {field: 'completedTaskCount', title: '已完成任务数量'}
                , {field: 'taskCount', title: '任务总数'}
                , {field: 'queueSize', title: '队列里缓存的任务数量'}
                , {field: 'largestPoolSize', title: '池中存在的最大线程数'}
                , {field: 'maximumPoolSize', title: '最大允许的线程数'}
                , {field: 'shutdown', title: '线程池是否关闭'}
                , {field: 'terminated', title: '线程池是否终止'}
            ]]
            ,parseData:function(res){ //res 即为原始返回的数据

                var list=res.data;


                return {
                    "code": 0, //解析接口状态
                    "msg": res.message, //解析提示文本
                    "count": res.total, //解析数据长度
                    "data": list //解析数据列表
                };
            }
        }
        table.render(opt1);

        var opt2=  {
            id:"table2"
            ,elem: '#dataTable2'
            // ,type:'checkbox'
            , url: '/monitor/getQueueMonitor'
            , cellMinWidth: 80
            ,contentType:'application/json'
            , method: 'post'
            , cols: [[
                {title: '序号', type: 'numbers'}
                // , {type:'checkbox'}
                , {field: 'queueName',  title: '队列名称',width:200}
                , {field: 'maxSize',  title: '队列最大容量'}
                , {field: 'cacheNum', title: '已使用容量'}
                , {field: 'remainingCapacity', title: '剩余容量'}
            ]]
            ,parseData:function(res){ //res 即为原始返回的数据
                var list=res.data;
                return {
                    "code": 0, //解析接口状态
                    "msg": res.message, //解析提示文本
                    "count": res.total, //解析数据长度
                    "data": list //解析数据列表
                };
            }
        }
        table.render(opt2);





        element.on('tab(layui-tab_1)', function(data){
            //console.log(this); //当前Tab标题所在的原始DOM元素
            console.log(data.index); //得到当前Tab的所在下标
            //console.log(data.elem); //得到当前的Tab大容器

            //重新加载调度车站监控
            if (data.index==0){
                table.reload('table1', {
                    page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    ,where: {
                    }
                }, 'data');
            }
        });

    })





</script>
</html>